[1]: ./img/2022-11-21_02-35.png "Установка зависимостей через apt."
[2]: ./img/2022-11-21_02-46.png "Приложение Ubuntu Software."
[3]: ./img/2022-11-21_02-51.png "Установка VSCode (1)."
[4]: ./img/2022-11-21_02-59.png "Установка VSCode (2)."
[5]: ./img/2022-11-21_03-02.png "Дополнения в VSCode (1)."
[6]: ./img/2022-11-21_03-08.png "Дополнения в VSCode (2)."
[7]: ./img/2022-11-21_03-10.png "Дополнения в VSCode (3)."
[8]: ./img/2022-11-21_03-25.png "git clone."
[9]: ./img/2022-11-21_04-02.png "make prepare."
[10]: ./img/2022-11-21_04-13.png "make run."
[11]: ./img/2022-11-21_04-40.png "make."
[12]: ./img/2022-11-21_04-53.png "docker-compose."

## Оглавление
- [Подготовка окружения](#подготовка-окружения)
  - [Установка необходимых пакетов в ОС Ubuntu](#установка-необходимых-пакетов-в-ос-ubuntu)
  - [Установка дополнений в VS Code](#установка-дополнений-в-vs-code)
- [Настройка учебного примера **secure-update**](#настройка-учебного-примера-secure-update)
  - [Получение исходного кода](#получение-исходного-кода)
  - [Настройка среды](#настройка-среды)
- [Справочная информация](#справочная-информация)
  - [Немного про **docker**](#немного-про-docker)
  - [Немного про **make**](#немного-про-make)
- [Перечень нужных команд](#перечень-нужных-команд)
  - [При работе в терминале Linux](#при-работе-в-терминале-linux)
    - [Работа с файлами](#работа-с-файлами)
    - [Обращение с директориями](#обращение-с-директориями)
    - [Повышение привелегий при выполнении команд](#повышение-привелегий-при-выполнении-команд)
    - [Работа с пользователями](#работа-с-пользователями)
    - [Запуск программ и скриптов](#запуск-программ-и-скриптов)
    - [Вкл./Выкл. компьютер](#вклвыкл-компьютер)
  - [При работе с **docker**](#при-работе-с-docker)
 
# Подготовка окружения 
Для работы с предложенными сценариями потребуется установка некоторых пакетов и зависимостей как внутри VS Code, так и в самой Ubuntu.

<a name="Настройка_окружения"></a>

## Установка необходимых пакетов в ОС Ubuntu
Прежде всего, необходимо обновить список репозиториев и доступных для установки пакетов.
```bash
sudo apt update -y
```
`sudo` - для повышения привелегий во время работы с менеджером пакетов `apt`.  
Флаг `-y` нужен, чтобы на все вопросы пакетного менеджера ответить "Да".  
Теперь нужно установить все необходимые зависимости.  
```bash
sudo apt install build-essential screen docker-compose -y
```  
Так это выглядит:
![][1]  
  
Следующий шаг - установка VSCode.  
Для этого можно использовать приложение Ubuntu Software. Его можно без труда найти в списке всех установленных приложений:  
![][2]  
  
Воспользовавшись поиском, находим VS Code в магазине приложений и устанавливаем.
![][3]  
  
Когда установка будет закончена, VSCode, для удобства, можно будет переместить в панель Favourits:
![][4]  
  
Осталось разобраться с пакетами Python. Просто запустим установку `pipenv` и `pytest`:
```bash
sudo pip install pipenv
sudo pip install pytest
```
  
## Установка дополнений в VS Code
Наконец, можно приступить к настройке самого VSCode, а именно - установки необходимых дополнений к нему. Запустим его, проследуем в меню Extensions, в поиске найдём пакет Python (тот, что выпущен и верифицирован Microsoft) и установим:
![][5]  
  
Тем же способом установим пакеты `REST Client` и `docker-compose`:
![][6]
![][7]  
  
На данном этапе настройка окружения почти закончена, однако остальные компоненты будут установлены автоматически в процессе развёртки учебного примера **secure-update**.
  

# Настройка учебного примера **secure-update**  
Это пример усиления защиты процедуры обновления с помощью шаблона «Монитор безопасности»: все межсервисные запросы проходят через службу «Монитор». Монитор проверяет, является ли конкретный запрос авторизованным и валидным, а затем доставляет его службе назначения или отбрасывает без дальнейшей обработки.  

## Получение исходного кода
Итак, прежде всего нужно скачать исходники этого проекта на github. В Linux можно воспользоваться утилитой командной строки **git**. Открываем терминал и пишем:  
```bash
git clone https://github.com/sergey-sobolev/secure-update.git
```  
Утилита самостоятельно загрузит все файлы проекта и сохранит их в единой директории.
![][8]  
  
## Настройка среды  
Репозиторий скачан и готов работать, однако для запуска контейнеров docker нужно также добавить пользователя в группу docker (и автоматически выдать, таким образом, права sudo на запуск контейнеров). В этом нам поможет следующая команда:  
```bash
sudo usermod -aG docker $USER
```  
 **После этой команды нужно перезапустить компьютер.**  
  
Осталось лишь запустить утилиту **make**, чтобы настроить окружение для работы:
```bash
make prepare
```  
В данном случае **make** - это имя утилиты, которую мы вызываем, а **prepare** - это цель сборки пакетов.  
_Подробнее об утилите **make** и целях сборки я расскажу в разделе со справочной информацией._  

Процесс настройки окружения займёт много времени. Об успешном завершении процесса будет свидетельсвовать отчёт утилиты **docker-compose**, который уведомит нас о запуске контейнеров **su-zookeeper** и **su-broker**:  
![][9]  
  
Когда настройка будет закончена, можно запускать сам учебный пример:
```bash
make run
```  
Должно получиться как-то так:  
![][10]
  
Учебный пример **secure-update** готов к работе!  
  
# Справочная информация
В этом разделе собрана полезная информаци, которая могла бы пригодиться при работе с Linux в рамках тренинка от Касперского.  
## Немного про **docker**
Docker – это программная платформа для быстрой разработки, тестирования и развертывания приложений. Docker упаковывает ПО в стандартизованные блоки, которые называются контейнерами. Каждый контейнер включает все необходимое для работы приложения: библиотеки, системные инструменты, код и среду исполнения. Благодаря Docker можно быстро развертывать и масштабировать приложения в любой среде и сохранять уверенность в том, что код будет работать.  

Docker-compose - это утилита, позволяющая управлять "композицией" из нескольких контейнеров. Такая композиция описывается в файле docker-compose.yml. Например, в учебном примере secure-update этот файл содержал следующее:  
![][12]  
Здесь мы можем видеть инструкции для контейнеров из этого проекта (su-zookeeper, su-broker, app_with_updater, file_server и другие). Для них указываются, среди прочего:
- Образ системы, на котором основывается тот или иной контейнер
- Имя контейнера
- Настройки для "проброса портов наружу"

## Немного про **make**
Make — утилита предназначенная для автоматизации преобразования файлов из одной формы в другую. Правила преобразования задаются в скрипте с именем Makefile, который должен находиться в корне рабочей директории проекта. Эти правила так же называют "целями".
В учебном примере **secure-update** Makefile содержал следующее:  
![][11]  
Здесь видно, что `make prepare` вызывает поочерёдно команды, описанные в **sys-packages**, **permissions** и далее по списку. Цель `make run` же запускает на исполнение команду **docker-compose up -d**, что, всего лишь, означает запуск всех контейнеров, содержащихся в текущем проекте.  
# Перечень нужных команд  
## При работе в терминале Linux 
### Работа с файлами
- `ls` - вывести список файлов в текущей директории
- `ls -la` - вывести в виде таблицы список всех файлов (включая скрытые) в текущей директории
- `pwd` - вывести текущую директорию
- `cat {имя файла}` - распечатать в терминале содержимое файла (как правило, применяется к текстовым файлам)
- `rm {имя файла}` - удалить указанный файл
- `rm -r {имя директории}` - удалить директорию
- `mv {имя файла} {путь куда переместить}` - переместить фвйл в указанное место  
- `mv -r {имя директории} {путь куда переместить}` - переместить директорию в указанное место 
- `cp {имя файла} {путь куда скопировать}` - скопировать файл в указанное место 
- `cp -r {имя директории} {путь куда скопировать}` - скопировать директорию в указанное место
- `touch {имя файла}` - создать в текущей директории файл
### Обращение с директориями
- `cd {путь куда переместиться}` - переместиться в указанную директорию 
- `cd ..` - переместиться на директорию выше 
### Повышение привелегий при выполнении команд
- `sudo {команда}`
### Работа с пользователями
- `sudo passwd {имя пользователя}` - сменить пароль указанного пользователя 
- `sudo adduser {имя пользователя}` - создать нового пользователя
- `sudo deluser {имя пользователя}` - удалить указанного пользователя
- `sudo usermod -aG {имя группы} {имя пользователя}` - добавить указанного пользователя в указанную группу  
### Запуск программ и скриптов
- `python3 {имя файла.py}` - запуск Python скрипта
- `./{имя файла.sh}` - запуск скрипта Bash
- `{название программы}` - запуск указанной программ (например, так можно запустить `code` или `firefox`)
### Вкл./Выкл. компьютер
- `shutdown now` - выключить компьютер
- `reboot` - перезагрузить компьютер  
## При работе с **docker**  
- `docker-compose up -d` - запуск всех контейнеров, содержащихся в проекте (строго говоря, тех, что описаны в файле docker-compose.yml)
- `docker-compose down` - выключить все запущенные в текущем проекте контейнеры
- `docker-compose up -d {имя контейнера} {имя ещё одного контейнера}` - запустить только некоторые контейнеры из текущего проекта 
- `docker-compose logs -f` - вывести логи всех контейнеров
- `docker-compose logs -f {имя контейнера}` - вывести логи конкретного контейнера
- `docker-compose ps` - показать список всех запущенных контейнеров
- `docker-compose exec {имя конейнера} {команда}` - выполнить команду в запущенном контейнере
